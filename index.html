<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner - Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(10, 15, 40, 0.9);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .navbar {
            width: 80px;
            background: rgba(15, 25, 60, 0.95);
            color: white;
            transition: width 0.3s ease;
            overflow: hidden;
            height: 100vh;
            position: fixed;
            z-index: 100;
            border-right: 1px solid rgba(100, 150, 255, 0.2);
        }

        .navbar.expanded {
            width: 220px;
        }

        .nav-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-profile {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #8e44ad);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
        }

        .nav-icon {
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .nav-icon:hover {
            transform: scale(1.1);
            color: #3498db;
        }

        .nav-links {
            list-style: none;
            padding: 20px 0;
            margin: 0;
        }

        .nav-item {
            padding: 15px 25px;
            transition: background-color 0.3s;
        }

        .nav-item:hover {
            background-color: rgba(52, 152, 219, 0.2);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.7), transparent);
            border-left: 4px solid #3498db;
        }

        .nav-item a {
            color: #e0e0ff;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-right: 15px;
            width: 30px;
            text-align: center;
            transition: transform 0.3s;
        }

        .nav-item:hover i {
            transform: scale(1.2);
        }

        .nav-text {
            display: none;
            white-space: nowrap;
            font-weight: 500;
        }

        .navbar.expanded .nav-text {
            display: inline;
        }

        .main-content {
            flex: 1;
            margin-left: 80px;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        .navbar.expanded ~ .main-content {
            margin-left: 220px;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
            min-height: calc(100vh - 60px);
        }

        .page.active-page {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            margin-bottom: 25px;
            color: #fff;
            font-size: 2.8rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
            position: relative;
            padding-bottom: 15px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, transparent, #3498db, transparent);
            border-radius: 2px;
        }

        h2 {
            margin: 20px 0 15px;
            color: #e0e0ff;
            font-size: 1.8rem;
        }

        p {
            color: #b0b0ff;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: rgba(25, 40, 80, 0.9);
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .login-box h2 {
            margin-bottom: 25px;
            color: #fff;
            font-size: 2rem;
        }

        .login-box input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1rem;
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .login-box button:hover {
            background: linear-gradient(90deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .user-select {
            margin-top: 20px;
            text-align: left;
        }

        .user-select label {
            color: #b0b0ff;
            margin-bottom: 10px;
            display: block;
        }

        .user-select select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1rem;
        }

        .streak-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(25, 40, 80, 0.8);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .streak-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
        }

        .streak-label {
            font-size: 0.9rem;
            color: #b0b0ff;
        }

        .streak-fire {
            color: #e74c3c;
            font-size: 1.8rem;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #home {
            text-align: center;
            padding-top: 30px;
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 40px;
            justify-content: center;
        }

        .feature-card {
            flex: 1;
            min-width: 280px;
            max-width: 350px;
            background: rgba(25, 40, 80, 0.7);
            padding: 30px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 150, 255, 0.2);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
            background: rgba(30, 50, 100, 0.8);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #8e44ad);
        }

        .feature-card i {
            font-size: 3.5rem;
            color: #3498db;
            margin-bottom: 20px;
            background: rgba(20, 30, 60, 0.7);
            width: 80px;
            height: 80px;
            line-height: 80px;
            border-radius: 50%;
            text-align: center;
        }

        .feature-card h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 1.6rem;
        }

        .feature-card p {
            font-size: 1.1rem;
        }

        .timer-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(25, 40, 80, 0.7);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .current-task {
            background: rgba(20, 30, 60, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 1.2rem;
            color: #e0e0ff;
            border: 1px solid rgba(100, 150, 255, 0.3);
        }

        .timer-display {
            font-size: 5rem;
            font-family: 'Courier New', monospace;
            margin: 30px 0;
            color: #fff;
            text-shadow: 0 0 15px rgba(100, 150, 255, 0.7);
            letter-spacing: 3px;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .timer-controls button {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .timer-controls button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .timer-controls button:active {
            transform: translateY(1px);
        }

        #pause-timer {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        #reset-timer {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .pause-controls {
            display: none;
            margin-top: 25px;
            text-align: center;
        }

        .pause-controls button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0 10px;
            color: white;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .pause-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        #take-notes-btn {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
        }

        #switch-task-btn {
            background: linear-gradient(90deg, #f39c12, #d35400);
        }

        .timer-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
            background: rgba(20, 30, 60, 0.7);
            padding: 20px;
            border-radius: 15px;
        }

        .timer-settings label {
            text-align: left;
            font-weight: 500;
            color: #b0b0ff;
            font-size: 1.1rem;
        }

        .timer-settings input {
            padding: 12px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            width: 100%;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
        }

        .time-lock-container {
            margin-top: 20px;
            background: rgba(20, 30, 60, 0.7);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .time-lock-title {
            margin-bottom: 15px;
            color: #fff;
            font-size: 1.2rem;
        }

        .time-lock-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .time-lock-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 600;
            color: white;
        }

        #enable-time-lock {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        #disable-time-lock {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            display: none;
        }

        .time-lock-status {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #b0b0ff;
        }

        .progress-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 20px;
        }

        .progress-chart-container {
            flex: 1;
            min-width: 300px;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .progress-chart-container h3 {
            color: #fff;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .clock-visualization {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }

        .clock-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(20, 30, 60, 0.7);
            position: relative;
            overflow: hidden;
            border: 5px solid rgba(100, 150, 255, 0.2);
        }

        .clock-progress {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            clip: rect(0, 100px, 200px, 0);
            background: linear-gradient(135deg, #3498db, #2980b9);
            transform: rotate(0deg);
            transition: transform 0.5s linear;
        }

        .clock-progress-fill {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            clip: rect(0, 100px, 200px, 0);
            background: linear-gradient(135deg, #3498db, #2980b9);
            transform: rotate(180deg);
            transition: transform 0.5s linear;
        }

        .clock-inner {
            position: absolute;
            width: 80%;
            height: 80%;
            background: rgba(25, 40, 80, 0.7);
            border-radius: 50%;
            top: 10%;
            left: 10%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
            border: 3px solid rgba(100, 150, 255, 0.2);
        }

        .progress-stats {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 280px;
        }

        .stat-card {
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .stat-card h3 {
            color: #b0b0ff;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.2rem;
            color: #fff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
        }

        .subject-list {
            margin-top: 20px;
            width: 100%;
        }

        .subject-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid rgba(100, 150, 255, 0.2);
        }

        .subject-name {
            display: flex;
            align-items: center;
        }

        .subject-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 10px;
            display: inline-block;
        }

        .task-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .task-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .task-form input {
            flex: 2;
            min-width: 200px;
            padding: 15px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
        }

        .task-form button {
            padding: 15px 30px;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }

        .task-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.6);
        }

        .task-form select {
            padding: 15px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
            min-width: 200px;
        }

        .task-list {
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .task-list h3 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.5rem;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 150, 255, 0.3);
        }

        .task-list ul {
            list-style: none;
            margin-bottom: 30px;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(100, 150, 255, 0.2);
            background: rgba(20, 30, 60, 0.5);
            margin-bottom: 10px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .task-item:hover {
            background: rgba(30, 50, 100, 0.7);
            transform: translateX(5px);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .task-checkbox {
            cursor: pointer;
            width: 20px;
            height: 20px;
        }

        .task-text {
            flex: 1;
            font-size: 1.2rem;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: #95a5a6;
        }

        .task-priority {
            font-size: 0.9rem;
            padding: 5px 12px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
        }

        .priority-low {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
        }

        .priority-medium {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .priority-high {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .task-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .task-actions button:hover {
            transform: translateY(-2px);
        }

        .start-task {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }

        .edit-task {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            color: white;
        }

        .delete-task {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .subtask-container {
            margin-top: 10px;
            padding-left: 30px;
            border-left: 2px solid rgba(100, 150, 255, 0.2);
        }

        .subtask-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .subtask-input {
            flex: 1;
            padding: 8px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 6px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 0.9rem;
        }

        .add-subtask {
            padding: 8px 15px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .add-subtask:hover {
            transform: translateY(-2px);
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            border-radius: 6px;
            background: rgba(15, 25, 50, 0.5);
        }

        .subtask-checkbox {
            cursor: pointer;
        }

        .subtask-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .subtask-text.completed {
            text-decoration: line-through;
            color: #95a5a6;
        }

        .delete-subtask {
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .delete-subtask:hover {
            transform: scale(1.2);
        }

        #calendar {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .fc {
            color: #fff;
        }

        .fc-header-toolbar {
            margin-bottom: 1em;
        }

        .fc-button {
            background: rgba(52, 152, 219, 0.7) !important;
            border: none !important;
            color: white !important;
            text-shadow: none !important;
            transition: all 0.3s;
        }

        .fc-button:hover {
            background: rgba(52, 152, 219, 1) !important;
            transform: translateY(-2px);
        }

        .fc-button-primary:not(:disabled).fc-button-active {
            background: rgba(41, 128, 185, 0.9) !important;
        }

        .fc-daygrid-day-number, .fc-col-header-cell-cushion {
            color: #e0e0ff;
        }

        .fc-daygrid-day-frame {
            background: rgba(20, 30, 60, 0.5);
        }

        .fc-day-today {
            background: rgba(52, 152, 219, 0.2) !important;
        }

        .fc-event {
            background: rgba(46, 204, 113, 0.7);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fc-event:hover {
            background: rgba(46, 204, 113, 1);
            transform: translateY(-2px);
        }

        .fc-event-title {
            font-weight: 500;
        }

        .notes-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }

        .notes-form {
            flex: 1;
            min-width: 300px;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .notes-form input,
        .notes-form textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
        }

        .notes-form textarea {
            min-height: 200px;
            resize: vertical;
        }

        .notes-form button {
            padding: 15px 30px;
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
            width: 100%;
        }

        .notes-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.6);
        }

        .notes-list {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .note-card {
            background: rgba(25, 40, 80, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
            transition: all 0.3s;
        }

        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        .note-card h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 1.5rem;
        }

        .note-card p {
            color: #b0b0ff;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .note-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .note-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .note-actions button:hover {
            transform: translateY(-2px);
        }

        .edit-note {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }

        .delete-note {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .history-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(100, 150, 255, 0.2);
            background: rgba(20, 30, 60, 0.5);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(30, 50, 100, 0.7);
        }

        .history-info {
            flex: 1;
        }

        .history-task {
            font-size: 1.2rem;
            color: #fff;
            margin-bottom: 5px;
        }

        .history-duration {
            color: #b0b0ff;
            font-size: 1rem;
        }

        .history-date {
            color: #b0b0ff;
            font-size: 1rem;
            white-space: nowrap;
            margin-left: 20px;
        }

        .friends-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .manage-friends {
            padding: 15px 30px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .manage-friends:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .friend-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .friend-card {
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
            transition: all 0.3s;
            text-align: center;
        }

        .friend-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        .friend-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #8e44ad);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            margin: 0 auto 15px;
            box-shadow: 0 0 15px rgba(100, 150, 255, 0.5);
        }

        .friend-card h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 1.5rem;
        }

        .friend-tasks {
            margin-top: 20px;
        }

        .friend-tasks h4 {
            color: #b0b0ff;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .friend-task-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(20, 30, 60, 0.5);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friend-task-priority {
            font-size: 0.8rem;
            padding: 3px 10px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
        }

        .feedback-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(25, 40, 80, 0.7);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #b0b0ff;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .rating {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .star {
            font-size: 2rem;
            color: #f1c40f;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.5;
        }

        .star.active,
        .star:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .feedback-container button[type="submit"] {
            padding: 15px 30px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            width: 100%;
        }

        .feedback-container button[type="submit"]:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .thank-you-message {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(25, 40, 80, 0.7);
            border-radius: 15px;
        }

        .thank-you-message h2 {
            color: #2ecc71;
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .thank-you-message p {
            font-size: 1.2rem;
            color: #b0b0ff;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(25, 40, 80, 0.9);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.2);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(231, 76, 60, 1);
            transform: rotate(90deg);
        }

        .modal-title {
            margin-bottom: 25px;
            color: #fff;
            font-size: 1.8rem;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.1rem;
        }

        .modal-button {
            padding: 15px 30px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            margin-top: 15px;
            width: 100%;
        }

        .modal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(20, 30, 60, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #8e44ad);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .friend-status {
            font-size: 0.9rem;
            color: #b0b0ff;
        }

        .friend-status.friends {
            color: #2ecc71;
        }

        .friend-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .add-friend {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
        }

        .remove-friend {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .task-select-list {
            list-style: none;
            margin-bottom: 25px;
        }

        .task-select-item {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(100, 150, 255, 0.3);
            margin-bottom: 10px;
            transition: all 0.3s;
            background: rgba(20, 30, 60, 0.5);
        }

        .task-select-item:hover {
            background: rgba(30, 50, 100, 0.7);
            transform: translateX(5px);
        }

        .task-select-item.selected {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.7), transparent);
            border-left: 4px solid #3498db;
        }

        .task-priority-label {
            padding: 5px 12px;
            border-radius: 15px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .event-modal-content {
            background: rgba(25, 40, 80, 0.9);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.2);
            position: relative;
        }

        .event-form-group {
            margin-bottom: 20px;
        }

        .event-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0ff;
            font-weight: 500;
        }

        .event-form-group input,
        .event-form-group textarea,
        .event-form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1rem;
        }

        .event-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .event-form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .event-form-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .save-event {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
        }

        .delete-event {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .cancel-event {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }

        .time-lock-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
            text-align: center;
        }

        .time-lock-warning h2 {
            color: #e74c3c;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .time-lock-warning p {
            font-size: 1.2rem;
            max-width: 600px;
            margin-bottom: 30px;
        }

        .time-lock-timer {
            font-size: 3rem;
            font-family: 'Courier New', monospace;
            margin-bottom: 30px;
            color: #f1c40f;
        }

        .time-lock-password {
            padding: 15px;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            background: rgba(10, 15, 40, 0.7);
            color: white;
            font-size: 1.2rem;
            width: 300px;
            max-width: 80%;
            margin-bottom: 20px;
        }

        .time-lock-submit {
            padding: 15px 30px;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .time-lock-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.6);
        }

        .edu-tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            border-bottom: 1px dotted #3498db;
        }
       
        .edu-tooltip .edu-tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: rgba(25, 40, 80, 0.95);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.3);
            font-size: 0.9rem;
            line-height: 1.6;
        }
       
        .edu-tooltip:hover .edu-tooltiptext {
            visibility: visible;
            opacity: 1;
        }
       
        .learning-concepts {
            background: rgba(25, 40, 80, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
       
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
       
        .concept-card {
            background: rgba(20, 30, 60, 0.5);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
       
        .concept-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
       
        .concept-card h4 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
       
        .concept-card p {
            color: #b0b0ff;
            font-size: 1rem;
        }
       
        .edu-insight {
            background: rgba(30, 50, 100, 0.6);
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
       
        .edu-insight h4 {
            color: #3498db;
            margin-bottom: 10px;
        }
       
        .progress-visualization {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 25px;
        }
       
        .visualization-card {
            flex: 1;
            min-width: 250px;
            background: rgba(20, 30, 60, 0.6);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
       
        .brain-icon {
            color: #9b59b6;
            margin-right: 8px;
        }
       
        .resources-section {
            margin-top: 40px;
        }
       
        .resource-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
       
        .resource-card {
            flex: 1;
            min-width: 250px;
            background: rgba(25, 40, 80, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
       
        .resource-card h4 {
            color: #3498db;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
       
        .resource-card ul {
            list-style-type: none;
            padding-left: 0;
        }
       
        .resource-card li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }
       
        .resource-card li:before {
            content: "•";
            color: #3498db;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -5px;
        }
       
        .resource-card a {
            color: #b0b0ff;
            text-decoration: none;
            transition: color 0.3s;
        }
       
        .resource-card a:hover {
            color: #3498db;
            text-decoration: underline;
        }
       
        .principles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 30px;
        }
       
        .principle-card {
            flex: 1;
            min-width: 300px;
            background: rgba(25, 40, 80, 0.7);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
       
        .principle-card h3 {
            color: #3498db;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        @media (max-width: 992px) {
            .navbar {
                width: 70px;
            }
           
            .navbar.expanded {
                width: 200px;
            }
           
            .main-content {
                margin-left: 70px;
                padding: 20px;
            }
           
            .navbar.expanded ~ .main-content {
                margin-left: 200px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                width: 100%;
                height: auto;
                position: relative;
            }
           
            .navbar.expanded {
                width: 100%;
            }
           
            .container {
                flex-direction: column;
            }
           
            .main-content {
                margin-left: 0;
                margin-top: 70px;
            }
           
            .navbar.expanded ~ .main-content {
                margin-left: 0;
            }
           
            .nav-links {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
           
            .nav-item {
                padding: 12px 15px;
            }
           
            .navbar.expanded .nav-item {
                justify-content: flex-start;
            }
           
            .feature-card {
                min-width: 100%;
            }
           
            .progress-container {
                flex-direction: column;
            }

            .notes-container {
                flex-direction: column;
            }

            .friend-list {
                grid-template-columns: 1fr;
            }

            .streak-display {
                top: 10px;
                right: 10px;
                padding: 10px;
                font-size: 0.9rem;
            }

            .streak-count {
                font-size: 1.2rem;
            }

            .streak-fire {
                font-size: 1.5rem;
            }
           
            .concept-grid {
                grid-template-columns: 1fr;
            }
           
            .progress-visualization {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h2>Welcome to Study Planner</h2>
            <input type="text" id="username" placeholder="Enter your name">
            <button id="login-btn">Continue</button>
            <div class="user-select">
                <label>Or select existing user:</label>
                <select id="existing-users">
                    <option value="">Select a user</option>
                </select>
            </div>
        </div>
    </div>

    <div class="streak-display" id="streak-display" style="display: none;">
        <i class="fas fa-fire streak-fire"></i>
        <div>
            <div class="streak-count" id="streak-count">0</div>
            <div class="streak-label">Day Streak</div>
        </div>
    </div>

    <div class="container">
        <nav class="navbar">
            <div class="nav-header">
                <i class="fas fa-bars nav-icon" id="nav-toggle"></i>
                <div class="user-profile" id="user-profile">U</div>
            </div>
            <ul class="nav-links">
                <li class="nav-item active">
                    <a href="#home">
                        <i class="fas fa-home"></i>
                        <span class="nav-text">Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#timer">
                        <i class="fas fa-clock"></i>
                        <span class="nav-text">Timer</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#calendar-page">
                        <i class="fas fa-calendar-alt"></i>
                        <span class="nav-text">Calendar</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#progress">
                        <i class="fas fa-chart-pie"></i>
                        <span class="nav-text">Progress</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#tasks">
                        <i class="fas fa-tasks"></i>
                        <span class="nav-text">Tasks</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#history">
                        <i class="fas fa-history"></i>
                        <span class="nav-text">History</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#friends">
                        <i class="fas fa-users"></i>
                        <span class="nav-text">Friends</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#notes">
                        <i class="fas fa-sticky-note"></i>
                        <span class="nav-text">Notes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#feedback">
                        <i class="fas fa-comment-alt"></i>
                        <span class="nav-text">Feedback</span>
                    </a>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <section id="home" class="page active-page">
                <h1>Study Hub: Educational Edition</h1>
                <h2>Welcome to the Premium Educational Study Planner</h2>
                <p>Master your study routine with scientifically-backed learning techniques and advanced organization tools.</p>
               
                <div class="learning-concepts">
                    <h3><i class="fas fa-brain brain-icon"></i> Learning Science Principles</h3>
                    <p>This planner incorporates evidence-based learning strategies to maximize your study effectiveness:</p>
                   
                    <div class="concept-grid">
                        <div class="concept-card">
                            <h4>Spaced Repetition</h4>
                            <p>Review information at increasing intervals to combat the forgetting curve. Improves long-term retention by up to 200%.</p>
                        </div>
                        <div class="concept-card">
                            <h4>Active Recall</h4>
                            <p>Testing yourself strengthens neural pathways more effectively than passive review. Boosts retention by 50-70%.</p>
                        </div>
                        <div class="concept-card">
                            <h4>Interleaved Practice</h4>
                            <p>Mixing different subjects during study sessions improves concept differentiation and application.</p>
                        </div>
                        <div class="concept-card">
                            <h4>Pomodoro Technique</h4>
                            <p>Working in focused 25-minute intervals prevents mental fatigue and maintains cognitive performance.</p>
                        </div>
                    </div>
                </div>
               
                <div class="features">
                    <div class="feature-card" onclick="document.querySelector('.nav-item a[href=\'#timer\']').parentElement.click()">
                        <i class="fas fa-clock"></i>
                        <h3>Study Timer</h3>
                        <p>Track your study sessions with our built-in Pomodoro timer to maximize productivity.</p>
                        <div class="edu-insight">
                            <h4>Why it works:</h4>
                            <p>Aligns with natural attention span cycles. Focused intervals followed by breaks maintain optimal cognitive performance.</p>
                        </div>
                    </div>
                   
                    <div class="feature-card" onclick="document.querySelector('.nav-item a[href=\'#tasks\']').parentElement.click()">
                        <i class="fas fa-tasks"></i>
                        <h3>Task Management</h3>
                        <p>Create, prioritize, and manage your study tasks efficiently with our task system.</p>
                        <div class="edu-insight">
                            <h4>Why it works:</h4>
                            <p>Breaking complex subjects into manageable tasks reduces cognitive load and prevents overwhelm.</p>
                        </div>
                    </div>
                   
                    <div class="feature-card" onclick="document.querySelector('.nav-item a[href=\'#calendar-page\']').parentElement.click()">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Study Calendar</h3>
                        <p>Plan your study sessions and track your progress with our interactive calendar.</p>
                        <div class="edu-insight">
                            <h4>Why it works:</h4>
                            <p>Scheduling activates the brain's commitment mechanisms, making follow-through more likely.</p>
                        </div>
                    </div>
                </div>
               
                <div class="resources-section">
                    <h2><i class="fas fa-book brain-icon"></i> Recommended Learning Resources</h2>
                    <div class="resource-list">
                        <div class="resource-card">
                            <h4><i class="fas fa-brain"></i> Cognitive Science</h4>
                            <ul>
                                <li><a href="https://www.learningscientists.org" target="_blank">The Learning Scientists</a> - Evidence-based study strategies</li>
                                <li><a href="https://www.coursera.org/learn/learning-how-to-learn" target="_blank">Learning How to Learn</a> - Popular Coursera course</li>
                                <li><a href="https://www.retrievalpractice.org" target="_blank">Retrieval Practice</a> - Science of effective recall</li>
                            </ul>
                        </div>
                       
                        <div class="resource-card">
                            <h4><i class="fas fa-graduation-cap"></i> Study Techniques</h4>
                            <ul>
                                <li><a href="https://fs.blog/spaced-repetition/" target="_blank">Spaced Repetition Guide</a> - Master long-term retention</li>
                                <li><a href="https://www.apa.org/ed/precollege/psychology-teacher-network/introductory-psychology/active-learning" target="_blank">Active Learning Strategies</a> - APA resource</li>
                                <li><a href="https://www.pomodorotechnique.com" target="_blank">Pomodoro Technique</a> - Official website</li>
                            </ul>
                        </div>
                       
                        <div class="resource-card">
                            <h4><i class="fas fa-book-open"></i> Books</h4>
                            <ul>
                                <li><a href="https://www.makeitstick.com" target="_blank">Make It Stick</a> - Science of successful learning</li>
                                <li><a href="https://barbaraoakley.com/books/a-mind-for-numbers/" target="_blank">A Mind for Numbers</a> - Math and science learning</li>
                                <li><a href="https://www.calnewport.com/books/deep-work/" target="_blank">Deep Work</a> - Focus in a distracted world</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="timer" class="page">
                <h1>Study Timer <span class="edu-tooltip">ⓘ
                    <span class="edu-tooltiptext">
                        Research shows that focused 25-50 minute study blocks followed by 5-10 minute breaks align with natural cognitive rhythms, preventing mental fatigue.
                    </span>
                </span></h1>
                <div class="timer-container">
                    <div class="current-task">Current Task: <strong id="current-task-display">Select a task to start</strong></div>
                    <div class="timer-display">25:00</div>
                    <div class="timer-controls">
                        <button id="start-timer">Start</button>
                        <button id="pause-timer">Pause</button>
                        <button id="reset-timer">Reset</button>
                    </div>
                    <div class="pause-controls">
                        <button id="take-notes-btn">Take Notes</button>
                        <button id="switch-task-btn">Switch Task</button>
                    </div>
                   
                    <div class="edu-insight">
                        <h4>Optimal Study-Break Ratios:</h4>
                        <ul>
                            <li><strong>25 minutes study / 5 minutes break</strong> - Best for intense focus sessions</li>
                            <li><strong>50 minutes study / 10 minutes break</strong> - Ideal for complex material</li>
                            <li><strong>90 minutes study / 20 minutes break</strong> - Suitable for deep work sessions</li>
                        </ul>
                    </div>
                   
                    <div class="timer-settings">
                        <label for="study-time">Study Time (minutes):</label>
                        <input type="number" id="study-time" value="25" min="1">
                        <label for="break-time">Break Time (minutes):</label>
                        <input type="number" id="break-time" value="5" min="1">
                    </div>
                   
                    <div class="principles-container">
                        <div class="principle-card">
                            <h3><i class="fas fa-brain brain-icon"></i> Focused vs Diffused Thinking</h3>
                            <p>Your brain alternates between focused (concentrated effort) and diffused (background processing) modes. The Pomodoro technique leverages both:</p>
                            <div class="progress-visualization">
                                <div class="visualization-card">
                                    <h4>Focused Mode</h4>
                                    <p>During study periods, concentrate intensely to build strong neural pathways.</p>
                                </div>
                                <div class="visualization-card">
                                    <h4>Diffused Mode</h4>
                                    <p>During breaks, your brain makes subconscious connections and consolidates memories.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                   
                    <div class="time-lock-container">
                        <div class="time-lock-title">Focus Mode <span class="edu-tooltip">ⓘ
                            <span class="edu-tooltiptext">
                                Focus Mode uses commitment devices to strengthen willpower and reduce decision fatigue about continuing study sessions.
                            </span>
                        </span></div>
                        <div class="time-lock-controls">
                            <button id="enable-time-lock">Enable Time Lock</button>
                            <button id="disable-time-lock">Disable Time Lock</button>
                        </div>
                        <div class="time-lock-status" id="time-lock-status">Focus mode is currently disabled</div>
                    </div>
                </div>
            </section>

            <section id="calendar-page" class="page">
                <h1>Study Calendar</h1>
                <div id="calendar"></div>
            </section>

            <section id="progress" class="page">
                <h1>Your Learning Progress</h1>
                <div class="progress-container">
                    <div class="progress-chart-container">
                        <h3>Current Session Progress</h3>
                        <div class="clock-visualization">
                            <div class="clock-circle">
                                <div class="clock-progress" id="clock-progress"></div>
                                <div class="clock-progress-fill" id="clock-progress-fill"></div>
                                <div class="clock-inner" id="clock-text">25:00</div>
                            </div>
                        </div>
                       
                        <div class="progress-visualization">
                            <div class="visualization-card">
                                <h4>Retention Curve</h4>
                                <canvas id="retention-chart" width="300" height="200"></canvas>
                            </div>
                            <div class="visualization-card">
                                <h4>Focus Over Time</h4>
                                <canvas id="focus-chart" width="300" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                   
                    <div class="progress-stats">
                        <div class="stat-card">
                            <h3>Total Study Time</h3>
                            <p class="stat-value" id="total-study-time">0 hours</p>
                            <div class="edu-insight">
                                <p>Focused, deliberate practice is more important than raw hours for skill mastery.</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h3>Sessions Completed</h3>
                            <p class="stat-value" id="sessions-completed">0</p>
                            <div class="edu-insight">
                                <p>Distributed practice leads to 50% better retention than cramming.</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h3>Tasks Completed</h3>
                            <p class="stat-value" id="tasks-completed">0</p>
                            <div class="edu-insight">
                                <p>Completing tasks releases dopamine, creating a positive feedback loop.</p>
                            </div>
                        </div>
                    </div>
                </div>
               
                <div class="principles-container">
                    <div class="principle-card">
                        <h3><i class="fas fa-brain brain-icon"></i> The Forgetting Curve</h3>
                        <p>Without reinforcement, we forget:</p>
                        <ul>
                            <li>50% of new information within one hour</li>
                            <li>70% within 24 hours</li>
                            <li>90% within one week</li>
                        </ul>
                        <p>This planner combats forgetting through spaced repetition and active recall.</p>
                    </div>
                   
                    <div class="principle-card">
                        <h3><i class="fas fa-brain brain-icon"></i> Neuroplasticity</h3>
                        <p>Your brain's ability to form new neural connections:</p>
                        <ul>
                            <li>Neural connections weaken with disuse</li>
                            <li>Learning enhances neural processing</li>
                            <li>Training requires specificity and repetition</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="tasks" class="page">
                <h1>Your Tasks</h1>
                <div class="task-container">
                    <div class="task-form">
                        <input type="text" id="new-task" placeholder="Add a new task...">
                        <button id="add-task">Add Task</button>
                        <select id="task-priority">
                            <option value="low">Low Priority</option>
                            <option value="medium" selected>Medium Priority</option>
                            <option value="high">High Priority</option>
                        </select>
                    </div>
                    <div class="task-list">
                        <h3>Pending Tasks</h3>
                        <ul id="pending-tasks"></ul>
                        <h3>Completed Tasks</h3>
                        <ul id="completed-tasks"></ul>
                    </div>
                </div>
            </section>

            <section id="history" class="page">
                <h1>Study History</h1>
                <div class="history-container">
                    <div class="history-list" id="history-list"></div>
                </div>
            </section>

            <section id="friends" class="page">
                <h1>Friends</h1>
                <div class="friends-container">
                    <button class="manage-friends" id="manage-friends">
                        <i class="fas fa-user-plus"></i> Manage Friends
                    </button>
                    <div class="friend-list" id="friend-list"></div>
                </div>
            </section>

            <section id="notes" class="page">
                <h1>Your Notes</h1>
                <div class="notes-container">
                    <div class="notes-form">
                        <input type="text" id="note-title" placeholder="Note title...">
                        <textarea id="note-content" placeholder="Write your note here..."></textarea>
                        <button id="save-note">Save Note</button>
                    </div>
                    <div class="notes-list" id="notes-list"></div>
                </div>
            </section>

            <section id="feedback" class="page">
                <h1>Feedback</h1>
                <div class="feedback-container">
                    <form id="feedback-form">
                        <div class="form-group">
                            <label for="feedback-name">Your Name:</label>
                            <input type="text" id="feedback-name" required>
                        </div>
                        <div class="form-group">
                            <label for="feedback-email">Your Email:</label>
                            <input type="email" id="feedback-email" required>
                        </div>
                        <div class="form-group">
                            <label for="feedback-message">Your Feedback:</label>
                            <textarea id="feedback-message" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="feedback-rating">Rating:</label>
                            <div class="rating">
                                <span class="star" data-value="1">★</span>
                                <span class="star" data-value="2">★</span>
                                <span class="star" data-value="3">★</span>
                                <span class="star" data-value="4">★</span>
                                <span class="star" data-value="5">★</span>
                            </div>
                            <input type="hidden" id="feedback-rating" value="0">
                        </div>
                        <button type="submit">Submit Feedback</button>
                    </form>
                    <div class="thank-you-message">
                        <h2>Thank you for your feedback!</h2>
                        <p>We appreciate you taking the time to help us improve.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-overlay" id="user-management-modal" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" id="close-user-management">&times;</button>
            <h2 class="modal-title">Manage Friends</h2>
            <input type="text" id="friend-username" class="modal-input" placeholder="Enter friend's username">
            <button class="modal-button" id="add-friend-btn">Add Friend</button>
            <div class="user-list" id="user-list"></div>
        </div>
    </div>

    <div class="modal-overlay" id="task-selection-modal" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" id="close-task-selection">&times;</button>
            <h2 class="modal-title">Select a Task</h2>
            <ul class="task-select-list" id="task-select-list"></ul>
        </div>
    </div>

    <div class="modal-overlay" id="event-modal" style="display:none;">
        <div class="event-modal-content">
            <button class="modal-close" id="close-event-modal">&times;</button>
            <h2 class="modal-title" id="event-modal-title">Add Study Session</h2>
            <form id="event-form">
                <div class="event-form-group">
                    <label for="event-title">Title:</label>
                    <input type="text" id="event-title" required>
                </div>
                <div class="event-form-group">
                    <label for="event-start">Start:</label>
                    <input type="datetime-local" id="event-start" required>
                </div>
                <div class="event-form-group">
                    <label for="event-end">End:</label>
                    <input type="datetime-local" id="event-end" required>
                </div>
                <div class="event-form-group">
                    <label for="event-description">Description:</label>
                    <textarea id="event-description"></textarea>
                </div>
                <div class="event-form-group">
                    <label for="event-task">Related Task (optional):</label>
                    <select id="event-task">
                        <option value="">None</option>
                    </select>
                </div>
                <div class="event-form-buttons">
                    <button type="button" class="save-event" id="save-event">Save</button>
                    <button type="button" class="delete-event" id="delete-event" style="display:none;">Delete</button>
                    <button type="button" class="cancel-event" id="cancel-event">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div class="time-lock-warning" id="time-lock-warning" style="display:none;">
        <h2>Focus Mode Active</h2>
        <p>You've enabled focus mode which prevents you from leaving the study timer until the session is complete or you enter your password.</p>
        <div class="time-lock-timer" id="time-lock-timer">25:00</div>
        <input type="password" class="time-lock-password" id="time-lock-password" placeholder="Enter your password to exit">
        <button class="time-lock-submit" id="time-lock-submit">Submit</button>
    </div>

    <script>
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('studyPlannerUsers')) || {};
        let friends = JSON.parse(localStorage.getItem('studyPlannerFriends')) || {};
        let studyHistory = JSON.parse(localStorage.getItem('studyPlannerHistory')) || {};
        let streaks = JSON.parse(localStorage.getItem('studyPlannerStreaks')) || {};
        let calendarEvents = JSON.parse(localStorage.getItem('studyPlannerCalendarEvents')) || {};

        const loginContainer = document.querySelector('.login-container');
        const loginBtn = document.getElementById('login-btn');
        const usernameInput = document.getElementById('username');
        const existingUsersSelect = document.getElementById('existing-users');
        const userProfile = document.getElementById('user-profile');
        const userManagementModal = document.getElementById('user-management-modal');
        const manageFriendsBtn = document.getElementById('manage-friends');
        const closeUserManagementBtn = document.getElementById('close-user-management');
        const addFriendBtn = document.getElementById('add-friend-btn');
        const friendUsernameInput = document.getElementById('friend-username');
        const userList = document.getElementById('user-list');
        const friendList = document.getElementById('friend-list');

        const currentTaskDisplay = document.getElementById('current-task-display');

        const timerDisplay = document.querySelector('.timer-display');
        const startBtn = document.getElementById('start-timer');
        const pauseBtn = document.getElementById('pause-timer');
        const resetBtn = document.getElementById('reset-timer');
        const studyTimeInput = document.getElementById('study-time');
        const breakTimeInput = document.getElementById('break-time');
        const clockText = document.getElementById('clock-text');
        const clockProgress = document.getElementById('clock-progress');
        const clockProgressFill = document.getElementById('clock-progress-fill');

        const pauseControls = document.querySelector('.pause-controls');
        const takeNotesBtn = document.getElementById('take-notes-btn');
        const switchTaskBtn = document.getElementById('switch-task-btn');
        const taskSelectionModal = document.getElementById('task-selection-modal');
        const taskSelectList = document.getElementById('task-select-list');
        const closeTaskSelectionBtn = document.getElementById('close-task-selection');

        const enableTimeLockBtn = document.getElementById('enable-time-lock');
        const disableTimeLockBtn = document.getElementById('disable-time-lock');
        const timeLockStatus = document.getElementById('time-lock-status');
        const timeLockWarning = document.getElementById('time-lock-warning');
        const timeLockTimer = document.getElementById('time-lock-timer');
        const timeLockPassword = document.getElementById('time-lock-password');
        const timeLockSubmit = document.getElementById('time-lock-submit');

        const calendarEl = document.getElementById('calendar');
        const eventModal = document.getElementById('event-modal');
        const closeEventModalBtn = document.getElementById('close-event-modal');
        const eventModalTitle = document.getElementById('event-modal-title');
        const eventForm = document.getElementById('event-form');
        const eventTitleInput = document.getElementById('event-title');
        const eventStartInput = document.getElementById('event-start');
        const eventEndInput = document.getElementById('event-end');
        const eventDescriptionInput = document.getElementById('event-description');
        const eventTaskSelect = document.getElementById('event-task');
        const saveEventBtn = document.getElementById('save-event');
        const deleteEventBtn = document.getElementById('delete-event');
        const cancelEventBtn = document.getElementById('cancel-event');

        const notesList = document.getElementById('notes-list');
        const saveNoteBtn = document.getElementById('save-note');
        const noteTitleInput = document.getElementById('note-title');
        const noteContentInput = document.getElementById('note-content');

        const feedbackForm = document.getElementById('feedback-form');
        const stars = document.querySelectorAll('.star');
        const ratingInput = document.getElementById('feedback-rating');
        const thankYouMessage = document.querySelector('.thank-you-message');

        const streakDisplay = document.getElementById('streak-display');
        const streakCount = document.getElementById('streak-count');

        let currentTaskId = null;
        const taskTimers = {};
        let timer = null;
        let isRunning = false;
        let isTimeLockActive = false;
        let timeLockTimerInterval = null;
        let timeLockEndTime = null;

        let calendar = null;
        let currentEvent = null;

        function initExistingUsers() {
            existingUsersSelect.innerHTML = '<option value="">Select a user</option>';
            Object.keys(users).forEach((username) => {
                const option = document.createElement('option');
                option.value = username;
                option.textContent = username;
                existingUsersSelect.appendChild(option);
            });
        }

        loginBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (username) {
                loginUser(username);
            }
        });

        existingUsersSelect.addEventListener('change', (e) => {
            if (e.target.value) {
                loginUser(e.target.value);
            }
        });

        function loginUser(username) {
            if (!users[username]) {
                users[username] = {
                    username,
                    tasks: [],
                    notes: [],
                    studyStats: {
                        totalStudyTime: 0,
                        sessionsCompleted: 0,
                        tasksCompleted: 0,
                    },
                    password: prompt('Set a password for your account (required for focus mode):') || 'password123'
                };
                localStorage.setItem('studyPlannerUsers', JSON.stringify(users));

                if (!friends[username]) {
                    friends[username] = [];
                    localStorage.setItem('studyPlannerFriends', JSON.stringify(friends));
                }

                if (!studyHistory[username]) {
                    studyHistory[username] = [];
                    localStorage.setItem('studyPlannerHistory', JSON.stringify(studyHistory));
                }

                if (!calendarEvents[username]) {
                    calendarEvents[username] = [];
                    localStorage.setItem('studyPlannerCalendarEvents', JSON.stringify(calendarEvents));
                }
            }

            currentUser = username;
            userProfile.textContent = username.charAt(0).toUpperCase();
            loginContainer.style.display = 'none';
            initExistingUsers();

            updateStreak();
            streakDisplay.style.display = 'flex';

            loadUserData();
            initializeTimerForUser();
            initializeCalendar();
        }

        function updateStreak() {
            if (!currentUser) return;
           
            const today = new Date().toDateString();
            const lastLogin = streaks[currentUser] ? new Date(streaks[currentUser].lastLogin) : null;
           
            if (!streaks[currentUser]) {
                streaks[currentUser] = {
                    streak: 1,
                    lastLogin: today
                };
            } else {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
               
                if (lastLogin.toDateString() === today) {
                } else if (lastLogin.toDateString() === yesterday.toDateString()) {
                    streaks[currentUser].streak += 1;
                    streaks[currentUser].lastLogin = today;
                } else {
                    streaks[currentUser].streak = 1;
                    streaks[currentUser].lastLogin = today;
                }
            }
           
            localStorage.setItem('studyPlannerStreaks', JSON.stringify(streaks));
            streakCount.textContent = streaks[currentUser].streak;
        }

        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');

        navItems.forEach((item) => {
            item.addEventListener('click', function () {
                navItems.forEach((navItem) => navItem.classList.remove('active'));
                this.classList.add('active');
                pages.forEach((page) => page.classList.remove('active-page'));
                const targetPage = this.querySelector('a').getAttribute('href');
                document.querySelector(targetPage).classList.add('active-page');
               
                if (targetPage !== '#timer') {
                    togglePauseControls(false);
                    pauseTimer();
                   
                    if (isTimeLockActive && isRunning) {
                        showTimeLockWarning();
                        this.classList.remove('active');
                        document.querySelector('.nav-item.active').classList.add('active');
                        document.querySelector(targetPage).classList.remove('active-page');
                        document.querySelector('.page.active-page').classClassList.add('active-page');
                    }
                }
            });
        });

        document.getElementById('nav-toggle').addEventListener('click', () => {
            document.querySelector('.navbar').classClassList.toggle('expanded');
        });

        function loadUserData() {
            if (!currentUser) return;
            const user = users[currentUser];

            updateStats();

            loadTasks();

            loadNotes();

            loadHistory();

            loadFriends();

            updateClockVisualization(0);
        }

        function loadTasks() {
            if (!currentUser) return;
            const pendingTasksList = document.getElementById('pending-tasks');
            const completedTasksList = document.getElementById('completed-tasks');

            pendingTasksList.innerHTML = '';
            completedTasksList.innerHTML = '';

            const tasks = users[currentUser].tasks;
            if (!tasks) return;

            tasks.forEach((task) => {
                const taskItem = createTaskElement(task);
                if (task.completed) {
                    completedTasksList.appendChild(taskItem);
                } else {
                    pendingTasksList.appendChild(taskItem);
                }
            });
        }

        function createTaskElement(task) {
            const taskItem = document.createElement('li');
            taskItem.className = 'task-item';
            taskItem.dataset.id = task.id;

            const priorityClass = `priority-${task.priority}`;

            taskItem.innerHTML = `
                <div class="task-info">
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                    <span class="task-text ${task.completed ? 'completed' : ''}">${task.text}</span>
                    <span class="task-priority ${priorityClass}">${task.priority}</span>
                </div>
                <div class="task-actions">
                    <button class="start-task">Start Task</button>
                    <button class="edit-task">Edit</button>
                    <button class="delete-task">Delete</button>
                </div>
            `;

            if (task.subtasks && task.subtasks.length > 0) {
                const subtaskContainer = document.createElement('div');
                subtaskContainer.className = 'subtask-container';
               
                task.subtasks.forEach(subtask => {
                    const subtaskItem = document.createElement('div');
                    subtaskItem.className = 'subtask-item';
                    subtaskItem.innerHTML = `
                        <input type="checkbox" class="subtask-checkbox" ${subtask.completed ? 'checked' : ''}>
                        <span class="subtask-text ${subtask.completed ? 'completed' : ''}">${subtask.text}</span>
                        <i class="fas fa-trash delete-subtask"></i>
                    `;
                   
                    const checkbox = subtaskItem.querySelector('.subtask-checkbox');
                    const deleteBtn = subtaskItem.querySelector('.delete-subtask');
                   
                    checkbox.addEventListener('change', function() {
                        subtask.completed = this.checked;
                        localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                    });
                   
                    deleteBtn.addEventListener('click', () => {
                        task.subtasks = task.subtasks.filter(st => st.id !== subtask.id);
                        localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                        loadTasks();
                    });
                   
                    subtaskContainer.appendChild(subtaskItem);
                });
               
                const subtaskForm = document.createElement('div');
                subtaskForm.className = 'subtask-form';
                subtaskForm.innerHTML = `
                    <input type="text" class="subtask-input" placeholder="Add a subtask...">
                    <button class="add-subtask">Add</button>
                `;
               
                const subtaskInput = subtaskForm.querySelector('.subtask-input');
                const addSubtaskBtn = subtaskForm.querySelector('.add-subtask');
               
                addSubtaskBtn.addEventListener('click', () => {
                    const text = subtaskInput.value.trim();
                    if (text) {
                        if (!task.subtasks) task.subtasks = [];
                        task.subtasks.push({
                            id: Date.now().toString(),
                            text,
                            completed: false
                        });
                        localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                        loadTasks();
                        subtaskInput.value = '';
                    }
                });
               
                subtaskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addSubtaskBtn.click();
                    }
                });
               
                subtaskContainer.appendChild(subtaskForm);
                taskItem.appendChild(subtaskContainer);
            }

            const checkbox = taskItem.querySelector('.task-checkbox');
            const startBtn = taskItem.querySelector('.start-task');
            const editBtn = taskItem.querySelector('.edit-task');
            const deleteBtn = taskItem.querySelector('.delete-task');

            checkbox.addEventListener('change', function () {
                const taskId = taskItem.dataset.id;
                const task = users[currentUser].tasks.find((t) => t.id === taskId);
                if (task) {
                    task.completed = this.checked;
                    if (this.checked) {
                        users[currentUser].studyStats.tasksCompleted++;
                    } else {
                        users[currentUser].studyStats.tasksCompleted--;
                    }
                    localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                    loadTasks();
                    updateStats();
                }
            });

            startBtn.addEventListener('click', function () {
                const taskId = taskItem.dataset.id;
                const task = users[currentUser].tasks.find((t) => t.id === taskId);
                if (task) {
                    currentTaskId = task.id;
                    currentTaskDisplay.textContent = `Currently working on: ${task.text}`;
                    document
                        .querySelector('.nav-item a[href="#timer"]')
                        .parentElement.click();

                    if (!taskTimers[currentTaskId]) {
                        const taskStudyTime = task.studyTime || getGlobalStudyTime();
                        taskTimers[currentTaskId] = {
                            timeLeft: taskStudyTime * 60,
                            isRunning: false,
                            isStudyTime: true,
                            totalSessionTime: taskStudyTime * 60,
                            startTime: null,
                        };
                    }

                    resetTimer();
                    startTimer();
                }
            });

            editBtn.addEventListener('click', () => {
                const taskId = taskItem.dataset.id;
                const task = users[currentUser].tasks.find((t) => t.id === taskId);
                if (!task) return;

                const newText = prompt('Edit your task:', task.text);
                if (newText === null || newText.trim() === '') return;

                let newStudyTime = prompt(
                    'Set custom study time in minutes (leave blank for default 25):',
                    task.studyTime || ''
                );
                if (newStudyTime !== null) {
                    newStudyTime = newStudyTime.trim();
                    if (newStudyTime !== '') {
                        const parsed = parseInt(newStudyTime, 10);
                        if (isNaN(parsed) || parsed < 1) {
                            alert('Invalid study time, must be a positive number.');
                            return;
                        }
                        task.studyTime = parsed;
                    } else {
                        delete task.studyTime;
                    }
                }

                task.text = newText.trim();
                localStorage.setItem('studyPlannerUsers', JSON.stringify(users));

                if (taskTimers[task.id]) {
                    const studyTimeMin = task.studyTime || getGlobalStudyTime();
                    taskTimers[task.id].totalSessionTime = studyTimeMin * 60;
                    if (!taskTimers[task.id].isRunning) {
                        taskTimers[task.id].timeLeft = studyTimeMin * 60;
                    }
                }

                loadTasks();

                if (task.id === currentTaskId && !isRunning) resetTimer();
            });

            deleteBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this task?')) {
                    const taskId = taskItem.dataset.id;
                    users[currentUser].tasks = users[currentUser].tasks.filter(
                        (t) => t.id !== taskId
                    );
                    localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                    loadTasks();

                    if (currentTaskId === taskId) {
                        currentTaskId = null;
                        currentTaskDisplay.textContent = 'Select a task to start';
                        resetTimer();
                    }
                }
            });

            return taskItem;
        }

        function addTask() {
            const taskText = document.getElementById('new-task').value.trim();
            const priority = document.getElementById('task-priority').value;
            if (!taskText) return;

            let customStudyTime = prompt(
                'Set custom study time in minutes for this task (or leave blank for default 25):',
                ''
            );
            let studyTimeValue = null;
            if (customStudyTime !== null) {
                customStudyTime = customStudyTime.trim();
                if (customStudyTime !== '') {
                    const parsed = parseInt(customStudyTime, 10);
                    if (isNaN(parsed) || parsed < 1) {
                        alert('Invalid input! Using default study time.');
                    } else {
                        studyTimeValue = parsed;
                    }
                }
            }

            const newTask = {
                id: Date.now().toString(),
                text: taskText,
                priority,
                completed: false,
                createdAt: new Date().toISOString(),
                subtasks: []
            };

            if (studyTimeValue) {
                newTask.studyTime = studyTimeValue;
            }

            users[currentUser].tasks.push(newTask);
            localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
            loadTasks();
            document.getElementById('new-task').value = '';
        }

        document.getElementById('add-task').addEventListener('click', addTask);
        document.getElementById('new-task').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        function getGlobalStudyTime() {
            return parseInt(studyTimeInput.value) || 25;
        }
        function getGlobalBreakTime() {
            return parseInt(breakTimeInput.value) || 5;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60)
                .toString()
                .padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }

        function updateDisplayCustom(timeLeftSec, totalSec) {
            const displayTime = formatTime(timeLeftSec);
            timerDisplay.textContent = displayTime;
            clockText.textContent = displayTime;

            const progress = ((totalSec - timeLeftSec) / totalSec) * 360;
            updateClockVisualization(progress);
        }

        function updateClockVisualization(progress) {
            if (progress <= 180) {
                clockProgress.style.transform = `rotate(${progress}deg)`;
                clockProgressFill.style.transform = 'rotate(0deg)';
            } else {
                clockProgress.style.transform = `rotate(180deg)`;
                clockProgressFill.style.transform = `rotate(${progress - 180}deg)`;
            }
        }

        function startTimer() {
            if (currentTaskId === null) {
                alert('Please start a task first.');
                return;
            }
            if (taskTimers[currentTaskId] && taskTimers[currentTaskId].isRunning) {
                return;
            }

            if (!taskTimers[currentTaskId]) {
                const task = users[currentUser].tasks.find((t) => t.id === currentTaskId);
                const taskStudyTime = (task && task.studyTime) || getGlobalStudyTime();
                taskTimers[currentTaskId] = {
                    timeLeft: taskStudyTime * 60,
                    isRunning: false,
                    isStudyTime: true,
                    totalSessionTime: taskStudyTime * 60,
                    startTime: null,
                };
            }

            isRunning = true;
            taskTimers[currentTaskId].isRunning = true;
            taskTimers[currentTaskId].startTime = new Date();

            togglePauseControls(false);

            timer = setInterval(() => {
                taskTimers[currentTaskId].timeLeft--;
                updateDisplayCustom(
                    taskTimers[currentTaskId].timeLeft,
                    taskTimers[currentTaskId].totalSessionTime
                );

                if (taskTimers[currentTaskId].timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    taskTimers[currentTaskId].isRunning = false;

                    const endTime = new Date();
                    const startTimeTask = taskTimers[currentTaskId].startTime;
                    const sessionDuration = Math.floor((endTime - startTimeTask) / 1000);

                    if (!studyHistory[currentUser]) studyHistory[currentUser] = [];
                    const task = users[currentUser].tasks.find((t) => t.id === currentTaskId);

                    studyHistory[currentUser].push({
                        task: task ? task.text : 'No specific task',
                        startTime: startTimeTask.toISOString(),
                        endTime: endTime.toISOString(),
                        duration: sessionDuration,
                    });
                    localStorage.setItem('studyPlannerHistory', JSON.stringify(studyHistory));

                    users[currentUser].studyStats.totalStudyTime += sessionDuration;
                    users[currentUser].studyStats.sessionsCompleted++;
                    localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                    updateStats();
                    loadHistory();

                    if (taskTimers[currentTaskId].isStudyTime) {
                        taskTimers[currentTaskId].isStudyTime = false;
                        taskTimers[currentTaskId].timeLeft = getGlobalBreakTime() * 60;
                        taskTimers[currentTaskId].totalSessionTime = taskTimers[currentTaskId].timeLeft;
                        alert('Study session complete! Time for a break.');
                    } else {
                        taskTimers[currentTaskId].isStudyTime = true;
                        const newStudyTime = (task && task.studyTime) || getGlobalStudyTime();
                        taskTimers[currentTaskId].timeLeft = newStudyTime * 60;
                        taskTimers[currentTaskId].totalSessionTime = taskTimers[currentTaskId].timeLeft;
                        alert('Break over! Time to get back to studying.');
                    }

                    updateDisplayCustom(
                        taskTimers[currentTaskId].timeLeft,
                        taskTimers[currentTaskId].totalSessionTime
                    );
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timer);
            if (currentTaskId && taskTimers[currentTaskId]) {
                taskTimers[currentTaskId].isRunning = false;
            }
            isRunning = false;
            togglePauseControls(true);
        }

        function resetTimer() {
            pauseTimer();
            if (currentTaskId) {
                const task = users[currentUser].tasks.find((t) => t.id === currentTaskId);
                const taskStudyTime = (task && task.studyTime) || getGlobalStudyTime();
                if (!taskTimers[currentTaskId]) {
                    taskTimers[currentTaskId] = {};
                }
                taskTimers[currentTaskId].timeLeft = taskStudyTime * 60;
                taskTimers[currentTaskId].totalSessionTime = taskTimers[currentTaskId].timeLeft;
                taskTimers[currentTaskId].isStudyTime = true;
                updateDisplayCustom(taskTimers[currentTaskId].timeLeft, taskTimers[currentTaskId].totalSessionTime);
            } else {
                updateDisplayCustom(getGlobalStudyTime() * 60, getGlobalStudyTime() * 60);
            }
            togglePauseControls(false);
        }

        function togglePauseControls(show) {
            pauseControls.style.display = show ? 'block' : 'none';
        }

        studyTimeInput.addEventListener('change', () => {
            if (
                !isRunning &&
                currentTaskId &&
                taskTimers[currentTaskId] &&
                taskTimers[currentTaskId].isStudyTime
            ) {
                const task = users[currentUser].tasks.find((t) => t.id === currentTaskId);
                const newTime = (task && task.studyTime) || getGlobalStudyTime();
                taskTimers[currentTaskId].timeLeft = newTime * 60;
                taskTimers[currentTaskId].totalSessionTime = taskTimers[currentTaskId].timeLeft;
                updateDisplayCustom(taskTimers[currentTaskId].timeLeft, taskTimers[currentTaskId].totalSessionTime);
            }
        });

        breakTimeInput.addEventListener('change', () => {
            if (
                !isRunning &&
                currentTaskId &&
                taskTimers[currentTaskId] &&
                !taskTimers[currentTaskId].isStudyTime
            ) {
                const newTime = getGlobalBreakTime();
                taskTimers[currentTaskId].timeLeft = newTime * 60;
                taskTimers[currentTaskId].totalSessionTime = taskTimers[currentTaskId].timeLeft;
                updateDisplayCustom(taskTimers[currentTaskId].timeLeft, taskTimers[currentTaskId].totalSessionTime);
            }
        });

        takeNotesBtn.addEventListener('click', () => {
            document.querySelector('.nav-item.active').classList.remove('active');
            document.querySelector('.nav-item a[href="#notes"]').parentElement.classList.add('active');
            pages.forEach((page) => page.classList.remove('active-page'));
            document.getElementById('notes').classList.add('active-page');
            togglePauseControls(false);
        });

        switchTaskBtn.addEventListener('click', () => {
            populateTaskSelectionModal();
            taskSelectionModal.style.display = 'flex';
            togglePauseControls(false);
        });

        closeTaskSelectionBtn.addEventListener('click', () => {
            taskSelectionModal.style.display = 'none';
        });

        function populateTaskSelectionModal() {
            taskSelectList.innerHTML = '';
            const tasks = users[currentUser].tasks;
            if (!tasks || tasks.length === 0) {
                taskSelectList.innerHTML = '<p>No tasks available.</p>';
                return;
            }

            tasks.forEach((task) => {
                const li = document.createElement('li');
                li.className = 'task-select-item';
                if (task.id === currentTaskId) {
                    li.classList.add('selected');
                }
                li.dataset.taskId = task.id;

                li.innerHTML = `
                    <span>${task.text}</span>
                    <span class="task-priority-label priority-${task.priority}">${task.priority}</span>
                `;

                li.addEventListener('click', () => {
                    if (task.id === currentTaskId) {
                        taskSelectionModal.style.display = 'none';
                        return;
                    }

                    if (isRunning) {
                        pauseTimer();
                    }

                    currentTaskId = task.id;
                    currentTaskDisplay.textContent = `Currently working on: ${task.text}`;

                    if (!taskTimers[currentTaskId]) {
                        const studyTime = task.studyTime || getGlobalStudyTime();
                        taskTimers[currentTaskId] = {
                            timeLeft: studyTime * 60,
                            isRunning: false,
                            isStudyTime: true,
                            totalSessionTime: studyTime * 60,
                            startTime: null,
                        };
                    }

                    updateDisplayCustom(
                        taskTimers[currentTaskId].timeLeft,
                        taskTimers[currentTaskId].totalSessionTime
                    );

                    document.querySelectorAll('.task-select-item').forEach((item) =>
                        item.classList.remove('selected')
                    );
                    li.classList.add('selected');

                    taskSelectionModal.style.display = 'none';
                });

                taskSelectList.appendChild(li);
            });
        }

        enableTimeLockBtn.addEventListener('click', () => {
            if (!isRunning) {
                alert('Please start a timer first to enable focus mode.');
                return;
            }

            isTimeLockActive = true;
            enableTimeLockBtn.style.display = 'none';
            disableTimeLockBtn.style.display = 'block';
            timeLockStatus.textContent = 'Focus mode is active - you cannot leave the timer until session ends';
            timeLockStatus.style.color = '#e74c3c';
           
            if (currentTaskId && taskTimers[currentTaskId]) {
                const now = new Date();
                timeLockEndTime = new Date(now.getTime() + taskTimers[currentTaskId].timeLeft * 1000);
            }
        });

        disableTimeLockBtn.addEventListener('click', () => {
            const password = prompt('Enter your password to disable focus mode:');
            if (password === users[currentUser].password) {
                disableTimeLock();
            } else {
                alert('Incorrect password. Focus mode remains active.');
            }
        });

        function disableTimeLock() {
            isTimeLockActive = false;
            enableTimeLockBtn.style.display = 'block';
            disableTimeLockBtn.style.display = 'none';
            timeLockStatus.textContent = 'Focus mode is currently disabled';
            timeLockStatus.style.color = '#b0b0ff';
            timeLockEndTime = null;
        }

        function showTimeLockWarning() {
            timeLockWarning.style.display = 'flex';
           
            if (timeLockEndTime) {
                updateTimeLockTimer();
                timeLockTimerInterval = setInterval(updateTimeLockTimer, 1000);
            }
           
            timeLockPassword.focus();
        }

        function updateTimeLockTimer() {
            if (!timeLockEndTime) return;
           
            const now = new Date();
            const diff = Math.max(0, timeLockEndTime - now);
            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
           
            timeLockTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
           
            if (diff <= 0) {
                clearInterval(timeLockTimerInterval);
                disableTimeLock();
                timeLockWarning.style.display = 'none';
            }
        }

        timeLockSubmit.addEventListener('click', () => {
            const password = timeLockPassword.value;
            if (password === users[currentUser].password) {
                disableTimeLock();
                timeLockWarning.style.display = 'none';
                timeLockPassword.value = '';
                clearInterval(timeLockTimerInterval);
            } else {
                alert('Incorrect password. Please try again.');
                timeLockPassword.value = '';
                timeLockPassword.focus();
            }
        });

        timeLockPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                timeLockSubmit.click();
            }
        });

        function initializeCalendar() {
            if (!currentUser) return;
           
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: calendarEvents[currentUser] || [],
                eventClick: function(info) {
                    openEventModal(info.event);
                },
                dateClick: function(info) {
                    createNewEvent(info.date);
                },
                eventContent: function(arg) {
                    return {
                        html: `<div class="fc-event-title">${arg.event.title}</div>`
                    };
                },
                height: 'auto'
            });
           
            calendar.render();
           
            updateEventTaskDropdown();
        }

        function updateEventTaskDropdown() {
            if (!currentUser) return;
           
            eventTaskSelect.innerHTML = '<option value="">None</option>';
            users[currentUser].tasks.forEach(task => {
                if (!task.completed) {
                    const option = document.createElement('option');
                    option.value = task.id;
                    option.textContent = task.text;
                    eventTaskSelect.appendChild(option);
                }
            });
        }

        function createNewEvent(date) {
            currentEvent = null;
            eventModalTitle.textContent = 'Add Study Session';
            deleteEventBtn.style.display = 'none';
           
            const start = new Date(date);
            const end = new Date(date);
            end.setHours(end.getHours() + 1);
           
            eventTitleInput.value = '';
            eventStartInput.value = formatDateTimeLocal(start);
            eventEndInput.value = formatDateTimeLocal(end);
            eventDescriptionInput.value = '';
            eventTaskSelect.value = '';
           
            eventModal.style.display = 'flex';
        }

        function openEventModal(event) {
            currentEvent = event;
            eventModalTitle.textContent = 'Edit Study Session';
            deleteEventBtn.style.display = 'block';
           
            const start = new Date(event.start);
            const end = event.end ? new Date(event.end) : new Date(start.getTime() + 3600000);
           
            eventTitleInput.value = event.title || '';
            eventStartInput.value = formatDateTimeLocal(start);
            eventEndInput.value = formatDateTimeLocal(end);
            eventDescriptionInput.value = event.extendedProps.description || '';
            eventTaskSelect.value = event.extendedProps.taskId || '';
           
            eventModal.style.display = 'flex';
        }

        function formatDateTimeLocal(date) {
            return date.toISOString().slice(0, 16);
        }

        closeEventModalBtn.addEventListener('click', () => {
            eventModal.style.display = 'none';
        });

        cancelEventBtn.addEventListener('click', () => {
            eventModal.style.display = 'none';
        });

        saveEventBtn.addEventListener('click', () => {
            const title = eventTitleInput.value.trim();
            const start = new Date(eventStartInput.value);
            const end = new Date(eventEndInput.value);
            const description = eventDescriptionInput.value.trim();
            const taskId = eventTaskSelect.value;
           
            if (!title) {
                alert('Please enter a title for the event.');
                return;
            }
           
            if (start >= end) {
                alert('End time must be after start time.');
                return;
            }
           
            const eventData = {
                title,
                start: start.toISOString(),
                end: end.toISOString(),
                description,
                taskId
            };
           
            if (currentEvent) {
                currentEvent.setProp('title', title);
                currentEvent.setStart(start);
                currentEvent.setEnd(end);
                currentEvent.setExtendedProp('description', description);
                currentEvent.setExtendedProp('taskId', taskId);
               
                const eventIndex = calendarEvents[currentUser].findIndex(e => e.id === currentEvent.id);
                if (eventIndex !== -1) {
                    calendarEvents[currentUser][eventIndex] = {
                        id: currentEvent.id,
                        ...eventData
                    };
                }
            } else {
                const newEvent = {
                    id: Date.now().toString(),
                    ...eventData
                };
               
                calendar.addEvent(newEvent);
                calendarEvents[currentUser].push(newEvent);
            }
           
            localStorage.setItem('studyPlannerCalendarEvents', JSON.stringify(calendarEvents));
            eventModal.style.display = 'none';
        });

        deleteEventBtn.addEventListener('click', () => {
            if (currentEvent && confirm('Are you sure you want to delete this event?')) {
                currentEvent.remove();
               
                calendarEvents[currentUser] = calendarEvents[currentUser].filter(e => e.id !== currentEvent.id);
                localStorage.setItem('studyPlannerCalendarEvents', JSON.stringify(calendarEvents));
               
                eventModal.style.display = 'none';
            }
        });

        function loadNotes() {
            if (!currentUser) return;
            const notes = users[currentUser].notes || [];
            notesList.innerHTML = '';

            notes.forEach((note) => {
                const noteCard = document.createElement('div');
                noteCard.className = 'note-card';
                noteCard.dataset.id = note.id;

                noteCard.innerHTML = `
                    <h3>${note.title}</h3>
                    <p>${note.content}</p>
                    <div class="note-actions">
                        <button class="edit-note">Edit</button>
                        <button class="delete-note">Delete</button>
                    </div>
                `;

                const editBtn = noteCard.querySelector('.edit-note');
                const deleteBtn = noteCard.querySelector('.delete-note');

                editBtn.addEventListener('click', () => {
                    const noteId = noteCard.dataset.id;
                    const note = users[currentUser].notes.find((n) => n.id === noteId);
                    if (!note) return;
                    const newTitle = prompt('Edit note title:', note.title);
                    const newContent = prompt('Edit note content:', note.content);
                    if (newTitle !== null && newContent !== null) {
                        note.title = newTitle;
                        note.content = newContent;
                        localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                        loadNotes();
                    }
                });

                deleteBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete this note?')) {
                        const noteId = noteCard.dataset.id;
                        users[currentUser].notes = users[currentUser].notes.filter((n) => n.id !== noteId);
                        localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
                        loadNotes();
                    }
                });

                notesList.appendChild(noteCard);
            });
        }

        saveNoteBtn.addEventListener('click', () => {
            const title = noteTitleInput.value.trim();
            const content = noteContentInput.value.trim();
            if (!title || !content) return alert('Please enter title and content for the note.');

            const newNote = {
                id: Date.now().toString(),
                title,
                content,
                createdAt: new Date().toISOString(),
            };

            if (!users[currentUser].notes) users[currentUser].notes = [];
            users[currentUser].notes.push(newNote);
            localStorage.setItem('studyPlannerUsers', JSON.stringify(users));
            loadNotes();

            noteTitleInput.value = '';
            noteContentInput.value = '';
        });

        function loadHistory() {
            if (!currentUser) return;
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            if (!studyHistory[currentUser] || studyHistory[currentUser].length === 0) {
                historyList.innerHTML = '<p>No study history recorded yet.</p>';
                return;
            }

            const sortedHistory = [...studyHistory[currentUser]].sort(
                (a, b) => new Date(b.endTime) - new Date(a.endTime)
            );

            sortedHistory.forEach((entry) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';

                const start = new Date(entry.startTime);
                const end = new Date(entry.endTime);
                const duration = Math.floor((end - start) / 60000);

                historyItem.innerHTML = `
                    <div class="history-info">
                        <div class="history-task">${entry.task || 'No specific task'}</div>
                        <div class="history-duration">Duration: ${duration} minutes</div>
                    </div>
                    <div class="history-date">${start.toLocaleDateString()}</div>
                `;

                historyList.appendChild(historyItem);
            });
        }

        userProfile.addEventListener('click', () => {
            userManagementModal.style.display = 'flex';
            populateUserList();
        });

        manageFriendsBtn.addEventListener('click', () => {
            userManagementModal.style.display = 'flex';
            populateUserList();
        });

        closeUserManagementBtn.addEventListener('click', () => {
            userManagementModal.style.display = 'none';
        });

        addFriendBtn.addEventListener('click', () => {
            const friendUsername = friendUsernameInput.value.trim();
            if (!friendUsername) return alert('Enter a username.');
            if (friendUsername === currentUser) return alert('Cannot add yourself.');
            if (!users[friendUsername]) return alert('User does not exist.');

            if (!friends[currentUser]) friends[currentUser] = [];

            if (friends[currentUser].includes(friendUsername)) {
                alert(`${friendUsername} is already in your friends list.`);
                return;
            }

            friends[currentUser].push(friendUsername);
            localStorage.setItem('studyPlannerFriends', JSON.stringify(friends));
            friendUsernameInput.value = '';
            populateUserList();
            loadFriends();
        });

        function populateUserList() {
            userList.innerHTML = '';
            Object.keys(users).forEach((username) => {
                if (username === currentUser) return;

                const isFriend = friends[currentUser] && friends[currentUser].includes(username);

                const userItem = document.createElement('div');
                userItem.className = 'user-item';

                userItem.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${username.charAt(0).toUpperCase()}</div>
                        <div>
                            <div>${username}</div>
                            <div class="friend-status ${isFriend ? 'friends' : ''}">${isFriend ? 'Friends' : 'Not Friends'}</div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        ${
                            isFriend
                                ? `<button class="remove-friend" data-username="${username}">Remove</button>`
                                : `<button class="add-friend" data-username="${username}">Add</button>`
                        }
                    </div>
                `;

                userList.appendChild(userItem);
            });

            document.querySelectorAll('.add-friend').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    const username = e.target.dataset.username;
                    if (!friends[currentUser].includes(username)) {
                        friends[currentUser].push(username);
                        localStorage.setItem('studyPlannerFriends', JSON.stringify(friends));
                        populateUserList();
                        loadFriends();
                    }
                });
            });

            document.querySelectorAll('.remove-friend').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    const username = e.target.dataset.username;
                    friends[currentUser] = friends[currentUser].filter((u) => u !== username);
                    localStorage.setItem('studyPlannerFriends', JSON.stringify(friends));
                    populateUserList();
                    loadFriends();
                });
            });
        }

        function loadFriends() {
            friendList.innerHTML = '';

            if (!friends[currentUser] || friends[currentUser].length === 0) {
                friendList.innerHTML = '<p>No friends added yet. Click "Manage Friends" to add some.</p>';
                return;
            }

            friends[currentUser].forEach((friend) => {
                if (!users[friend]) return;

                const friendCard = document.createElement('div');
                friendCard.className = 'friend-card';

                const activeTasks = users[friend].tasks
                    .filter((t) => !t.completed)
                    .slice(0, 3)
                    .map(
                        (task) => `
                        <div class="friend-task-item">
                            ${task.text}
                            <span class="friend-task-priority priority-${task.priority}">${task.priority}</span>
                        </div>`
                    )
                    .join('');

                friendCard.innerHTML = `
                    <div class="friend-avatar">${friend.charAt(0).toUpperCase()}</div>
                    <h3>${friend}</h3>
                    <div class="friend-tasks">
                        <h4>Current Tasks:</h4>
                        ${activeTasks || '<p>No active tasks</p>'}
                    </div>
                `;

                friendList.appendChild(friendCard);
            });
        }

        function updateStats() {
            if (!currentUser) return;
            const user = users[currentUser];
            const totalMinutes = Math.floor(user.studyStats.totalStudyTime / 60);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            document.getElementById('total-study-time').textContent = `${hours} hours ${minutes} minutes`;
            document.getElementById('sessions-completed').textContent = user.studyStats.sessionsCompleted;
            document.getElementById('tasks-completed').textContent = user.studyStats.tasksCompleted;
        }

        function initializeTimerForUser() {
            if (!currentUser) return;
            if (!users[currentUser].tasks || users[currentUser].tasks.length === 0) {
                currentTaskId = null;
                currentTaskDisplay.textContent = 'Select a task to start';
                resetTimer();
                return;
            }

            if (!currentTaskId || !users[currentUser].tasks.find((t) => t.id === currentTaskId)) {
                let firstTask = users[currentUser].tasks.find((t) => !t.completed);
                if (!firstTask) first极 = users[currentUser].tasks[0];

                currentTaskId = firstTask.id;
                currentTaskDisplay.textContent = `Currently working on: ${firstTask.text}`;
            }

            if (!taskTimers[currentTaskId]) {
                const task = users[currentUser].tasks.find((t) => t.id === currentTaskId);
                const taskStudyTime = (task && task.studyTime) || getGlobalStudyTime();
                taskTimers[currentTaskId] = {
                    timeLeft: taskStudyTime * 60,
                    isRunning: false,
                    isStudyTime: true,
                    totalSessionTime: taskStudyTime * 60,
                    startTime: null,
                };
            }

            updateDisplayCustom(
                taskTimers[currentTaskId].timeLeft,
                taskTimers[currentTaskId].totalSessionTime
            );
            togglePauseControls(false);
        }

        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        stars.forEach((star) => {
            star.addEventListener('click', function () {
                const value = parseInt(this.getAttribute('data-value'));
                ratingInput.value = value;

                stars.forEach((s) => {
                    s.classList.remove('active');
                    if (parseInt(s.getAttribute('data-value')) <= value) {
                        s.classList.add('active');
                    }
                });
            });
        });

        feedbackForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('feedback-name').value,
                email: document.getElementById('feedback-email').value,
                message: document.getElementById('feedback-message').value,
                rating: ratingInput.value,
            };

            console.log('Feedback submitted:', formData);

            feedbackForm.style.display = 'none';
            thankYouMessage.style.display = 'block';

            setTimeout(() => {
                feedbackForm.reset();
                stars.forEach((s) => s.classList.remove('active'));
                ratingInput.value = '0';
                feedbackForm.style.display = 'block';
                thankYouMessage.style.display = 'none';
            }, 5000);
        });

        function initEducationalCharts() {
            const retentionCtx = document.getElementById('retention-chart').getContext('2d');
            new Chart(retentionCtx, {
                type: 'line',
                data: {
                    labels: ['Immediately', '1 Hour', '1 Day', '1 Week', '1 Month'],
                    datasets: [{
                        label: 'Memory Retention',
                        data: [100, 50, 30, 20, 10],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtzero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Retention %'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'The Forgetting Curve'
                        }
                    }
                }
            });
           
            const focusCtx = document.getElementById('focus-chart').getContext('2d');
            new Chart(focusCtx, {
                type: 'line',
                data: {
                    labels: ['0 min', '10 min', '20 min', '30 min', '40 min', '50 min', '60 min'],
                    datasets: [{
                        label: 'Focus Level',
                        data: [70, 90, 85, 75, 60, 40, 30],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Focus %'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Focus Over Time'
                        }
                    }
                }
            });
        }
       
        document.addEventListener('DOMContentLoaded', function() {
            initEducationalCharts();
        });

        initExistingUsers();
    </script>
</body>
</html>